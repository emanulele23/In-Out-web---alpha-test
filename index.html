// Lista dei codici "mezzo"
const mezzoCodes = [
  "[00000003282680]", "[00000003282674]", "[00000003282673]", "[00000003282641]",
  "[00000003282716]", "[00000003282679]", "[00000003282675]", "[00000003282638]",
  "[00000003282715]", "[00000003282672]", "[00000003282644]", "[00000003282637]",
  "[00000003282980]", "[00000003282676]", "[00000003282643]", "[00000003282640]",
  "[00000003282678]", "[00000003282677]", "[00000003282642]", "[00000003282636]",
  "[00000003282708]", "[00000003282712]", "[00000003283000]", "[00000003282993]",
  "[00000003283003]", "[00000003282934]", "[00000003282711]", "[00000003282959]",
  "[00000003283008]", "[00000003282511]", "[00000003282709]", "[00000003282994]",
  "[00000003282752]", "[00000003283001]", "[00000003282986]", "[00000003282957]",
  "[00000003282960]", "[00000003282745]", "[00000003282916]", "[00000003282961]",
  "[00000003282747]", "[00000003282710]", "[00000003282751]", "[00000003282979]",
  "[00000003282978]", "[00000003282955]", "[00000003282914]", "[00000003282976]",
  "[00000003283020]", "[00000003282746]", "[00000003282958]", "[00000003282750]",
  "[00000003282744]", "[00000003282981]", "[00000003282935]", "[00000003282962]",
  "[00000003282984]", "[00000003282913]", "[00000003282915]", "[00000003283002]",
  "[00000003282749]", "[00000003282918]", "[00000003282983]", "[00000003282982]",
  "[00000003282917]", "[00000003282956]", "[00000003282985]", "[00000003282987]",
  "[00000003282748]", "[00000003282528]", "[00000003282499]", "[00000003282527]",
  "[00000003282501]", "[00000003282500]", "[00000003282507]", "[00000003282462]",
  "[00000003282461]", "[00000003282505]", "[00000003282506]", "[00000003282504]",
  "[00000003282525]", "[00000003282502]", "[00000003282405]", "[00000003282503]",
  "[00000003282404]", "[00000003282418]", "[00000003282421]", "[00000003282422]",
  "[00000003282402]", "[00000003282424]", "[00000003282425]", "[00000003282423]",
  "[00000003282398]", "[00000003282426]", "[00000003282403]", "[00000003282419]",
  "[00000003282397]", "[00000003282420]", "[00000003282460]", "[00000003282399]",
  "[00000003282400]", "[00000003282463]", "[00000003282464]", "[00000003282401]",
  "[00000003282508]", "[00000003282524]", "[00000003282509]", "[00000003282523]",
  "[00000003282510]", "[00000003282522]", "[00000003282977]", "[00000003282526]",
  "[00000003282512]", "[00000003282521]", "[00000003282516]", "[00000003282520]",
  "[00000003282713]", "[00000003282519]", "[00000003282714]", "[00000003282518]",
  "[00000003282639]", "[00000003282517]"
];

// Funzione per identificare il tipo di codice
function identifyCode(scannedCode) {
  // Rimuovere spazi e controllare la lunghezza
  const cleanCode = scannedCode.trim();
  
  if (cleanCode.length === 14 && mezzoCodes.includes(cleanCode)) {
    return 'mezzo';
  } else if (cleanCode.length === 16 && cleanCode.startsWith('[') && cleanCode.endsWith(']')) {
    return 'batteria';
  } else if (cleanCode.match(/^\[.{1}\d{6}.{1}\]$/)) {
    return 'corriere';
  } else {
    return 'unknown';
  }
}

// Esegui il log del risultato o popola i campi giusti
function processScannedCode(scannedCode) {
  const codeType = identifyCode(scannedCode);
  
  switch (codeType) {
    case 'mezzo':
      document.getElementById('mezzoField').value = scannedCode;
      break;
    case 'batteria':
      if (document.getElementById('batteriaField1').value === '') {
        document.getElementById('batteriaField1').value = scannedCode;
      } else {
        document.getElementById('batteriaField2').value = scannedCode;
      }
      break;
    case 'corriere':
      document.getElementById('corriereField').value = scannedCode;
      break;
    default:
      console.log('Codice sconosciuto:', scannedCode);
  }

  // Controllo se tutti i campi sono stati riempiti
  if (
    document.getElementById('mezzoField').value !== '' &&
    document.getElementById('batteriaField1').value !== '' &&
    document.getElementById('batteriaField2').value !== '' &&
    document.getElementById('corriereField').value !== ''
  ) {
    // Invia i dati all'App Script per il logging
    sendToGoogleScript();
  }
}

// Funzione per inviare i dati all'App Script
function sendToGoogleScript() {
  const mezzo = document.getElementById('mezzoField').value;
  const battery1 = document.getElementById('batteriaField1').value;
  const battery2 = document.getElementById('batteriaField2').value;
  const courier = document.getElementById('corriereField').value;

  const data = {
    vehicle: mezzo,
    battery1: battery1,
    battery2: battery2,
    courier: courier,
  };

  fetch('https://script.google.com/a/macros/justeattakeaway.com/s/AKfycbyxK96tAADpyPiNjny5Y8FWPRVPGFoEg2cdrecIEMzrn9YJF1nYqCQ0hcRLad61DbT1/exec', {
    method: 'POST',
    body: JSON.stringify(data),
    headers: {
      'Content-Type': 'application/json',
    },
  })
    .then((response) => response.json())
    .then((data) => {
      console.log('Success:', data);
      // Pulisci i campi dopo l'invio
      document.getElementById('mezzoField').value = '';
      document.getElementById('batteriaField1').value = '';
      document.getElementById('batteriaField2').value = '';
      document.getElementById('corriereField').value = '';
    })
    .catch((error) => {
      console.error('Error:', error);
    });
}
